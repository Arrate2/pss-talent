- name: Validación post-deployment
  hosts: role_web

  tasks: 
    - name: 1a. Esperar a que el puerto HTTP (80) esté disponible
      ansible.builtin.wait_for:
        port: 80
        host: "{{ ansible_host }}" # O la IP del localhost si se ejecuta en la propia instancia
        delay: 5
        timeout: 30
        state: started

    - name: 1b. Validar que WordPress responde con código HTTP 200
      ansible.builtin.uri:
        url: "http://{{ ansible_host }}" # Usar la IP del webserver
        method: GET
        status_code: 200
        timeout: 30
      register: http_check

    - name: Notificar éxito de validación
      ansible.builtin.debug:
        msg: "✅ Validación POST-DEPLOY exitosa. WordPress responde correctament
e (HTTP {{ http_check.status }})."
