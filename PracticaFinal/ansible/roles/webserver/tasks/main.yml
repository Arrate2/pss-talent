- name: 1. Instalar paquetes requeridos (Apache, PHP, dependencias)
  ansible.builtin.apt:
    name: ['apache2', 'php', 'php-mysql', 'libapache2-mod-php', 'wget', 'unzip', 'php-pgsql', 'postgresql-client']
    state: present
    update_cache: yes

- name: 2. Descargar e instalar WordPress
  ansible.builtin.unarchive:
    src: https://wordpress.org/latest.tar.gz
    dest: /tmp/
    remote_src: yes

- name: 2b. Mover WordPress a la carpeta webroot
  ansible.builtin.copy:
    src: /tmp/wordpress/
    dest: /var/www/html/
    remote_src: yes

- name: 3. Configurar wp-config.php con la plantilla
  ansible.builtin.template:
    src: wp-config.php # Referencia a la plantilla en el directorio 'templates/'
    dest: /var/www/html/wp-config.php
    owner: www-data
    group: www-data
    mode: '0644'

- name: 3. Establecer permisos correctos para WordPress
  ansible.builtin.file:
    path: /var/www/html
    state: directory
    recurse: yes
    owner: www-data
    group: www-data

- name: 4. Asegurar que el servicio apache2 est√© corriendo y habilitado al arranque
  ansible.builtin.service:
    name: apache2
    state: started
    enabled: yes
